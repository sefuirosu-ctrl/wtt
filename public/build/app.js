var R=Object.defineProperty;var T=(o,t,e)=>t in o?R(o,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):o[t]=e;var d=(o,t,e)=>T(o,typeof t!="symbol"?t+"":t,e);function k(){console.log("[DEBUG] Debug system initialized"),window.__WOT_DEBUG__={ping(){console.log("[DEBUG] pong")}}}class A{constructor(){this._listeners=new Map}on(t,e){if(!t||typeof e!="function")return console.warn("[EventBus] Invalid subscription",t,e),()=>{};const i=this._listeners.get(t)??new Set;return i.add(e),this._listeners.set(t,i),()=>this.off(t,e)}off(t,e){const i=this._listeners.get(t);i&&(i.delete(e),i.size===0&&this._listeners.delete(t))}emit(t,e=void 0){const i=this._listeners.get(t);if(!(!i||i.size===0))for(const s of Array.from(i))try{s(e)}catch(r){console.error(`[EventBus] Listener error for ${t}`,r)}}getListenerCount(t){return this._listeners.get(t)?.size??0}}class L{constructor(t={}){d(this,"_tick",t=>{if(!this._running)return;const e=t-this._lastNow;if(this._minFrameMs&&e<this._minFrameMs){this._rafId=requestAnimationFrame(this._tick);return}if(this._lastNow=t,!this._paused){const i=Math.max(0,e);this.onTick(i,t);for(const s of this._systems)s&&typeof s.update=="function"&&s.update(i,t)}this._rafId=requestAnimationFrame(this._tick)});const{onTick:e=null,maxFps:i=null,startPaused:s=!1}=t;this._running=!1,this._paused=!!s,this._lastNow=0,this._rafId=null,this._maxFps=typeof i=="number"&&i>0?i:null,this._minFrameMs=this._maxFps?1e3/this._maxFps:0,this._systems=[],this.onTick=typeof e=="function"?e:()=>{}}start(){this._running||(this._running=!0,this._lastNow=performance.now(),this._rafId=requestAnimationFrame(this._tick))}stop(){this._running=!1,this._rafId&&cancelAnimationFrame(this._rafId),this._rafId=null}pause(){this._paused=!0}resume(){this._paused=!1,this._lastNow=performance.now()}setOnTick(t){this.onTick=typeof t=="function"?t:()=>{}}addSystem(t){t&&!this._systems.includes(t)&&this._systems.push(t)}removeSystem(t){this._systems=this._systems.filter(e=>e!==t)}}const y={I:[[{x:-1,y:0},{x:0,y:0},{x:1,y:0},{x:2,y:0}],[{x:1,y:-1},{x:1,y:0},{x:1,y:1},{x:1,y:2}],[{x:-1,y:1},{x:0,y:1},{x:1,y:1},{x:2,y:1}],[{x:0,y:-1},{x:0,y:0},{x:0,y:1},{x:0,y:2}]],O:[[{x:0,y:0},{x:1,y:0},{x:0,y:1},{x:1,y:1}],[{x:0,y:0},{x:1,y:0},{x:0,y:1},{x:1,y:1}],[{x:0,y:0},{x:1,y:0},{x:0,y:1},{x:1,y:1}],[{x:0,y:0},{x:1,y:0},{x:0,y:1},{x:1,y:1}]],T:[[{x:-1,y:0},{x:0,y:0},{x:1,y:0},{x:0,y:1}],[{x:0,y:-1},{x:0,y:0},{x:0,y:1},{x:1,y:0}],[{x:-1,y:0},{x:0,y:0},{x:1,y:0},{x:0,y:-1}],[{x:0,y:-1},{x:0,y:0},{x:0,y:1},{x:-1,y:0}]],S:[[{x:0,y:0},{x:1,y:0},{x:-1,y:1},{x:0,y:1}],[{x:0,y:-1},{x:0,y:0},{x:1,y:0},{x:1,y:1}],[{x:0,y:0},{x:1,y:0},{x:-1,y:1},{x:0,y:1}],[{x:0,y:-1},{x:0,y:0},{x:1,y:0},{x:1,y:1}]],Z:[[{x:-1,y:0},{x:0,y:0},{x:0,y:1},{x:1,y:1}],[{x:1,y:-1},{x:1,y:0},{x:0,y:0},{x:0,y:1}],[{x:-1,y:0},{x:0,y:0},{x:0,y:1},{x:1,y:1}],[{x:1,y:-1},{x:1,y:0},{x:0,y:0},{x:0,y:1}]],J:[[{x:-1,y:0},{x:0,y:0},{x:1,y:0},{x:-1,y:1}],[{x:0,y:-1},{x:0,y:0},{x:0,y:1},{x:1,y:1}],[{x:-1,y:0},{x:0,y:0},{x:1,y:0},{x:1,y:-1}],[{x:0,y:-1},{x:0,y:0},{x:0,y:1},{x:-1,y:-1}]],L:[[{x:-1,y:0},{x:0,y:0},{x:1,y:0},{x:1,y:1}],[{x:0,y:-1},{x:0,y:0},{x:0,y:1},{x:1,y:-1}],[{x:-1,y:0},{x:0,y:0},{x:1,y:0},{x:-1,y:-1}],[{x:0,y:-1},{x:0,y:0},{x:0,y:1},{x:-1,y:1}]]};function B(o){let t=o>>>0;return function(){t+=1831565813;let e=Math.imul(t^t>>>15,1|t);return e^=e+Math.imul(e^e>>>7,61|e),((e^e>>>14)>>>0)/4294967296}}class C{constructor({width:t=10,height:e=20,seed:i=1}={}){this.width=t,this.height=e,this.grid=Array.from({length:e},()=>Array.from({length:t},()=>null)),this._rng=B(i),this._bag=[],this.active=null,this.hold=null,this.holdUsed=!1,this.gameOver=!1,this.gravityMs=800,this.softDropMultiplier=20,this._gravityTimer=0,this.spawnPiece()}clone(){return{width:this.width,height:this.height,cells:this.grid.map(t=>t.map(e=>e?{type:e.type}:null))}}getActivePieceSnapshot(){return this.active?{type:this.active.type,position:{x:this.active.x,y:this.active.y},blocks:this._getBlocks(this.active.type,this.active.rot)}:null}getGhostPieceSnapshot(){if(!this.active)return null;const t={...this.active};for(;this._canPlace(t.type,t.x,t.y+1,t.rot);)t.y++;return{type:t.type,position:{x:t.x,y:t.y},blocks:this._getBlocks(t.type,t.rot)}}update(t,e={}){if(this.gameOver)return{};if(!this.active)return{};const i=e.softDrop?this.gravityMs/this.softDropMultiplier:this.gravityMs;this._gravityTimer+=t;let s=!1;for(;this._gravityTimer>=i;){this._gravityTimer-=i;const r=this._stepDown();if(s=s||r.moved,r.touchedGround)return{moved:s,touchedGround:!0}}return{moved:s}}move(t){if(!this.active)return!1;const e=this.active.x+t;return this._canPlace(this.active.type,e,this.active.y,this.active.rot)?(this.active.x=e,!0):!1}rotate(t=1){if(!this.active)return!1;const e=(this.active.rot+(t>0?1:3))%4,i=[{x:0,y:0},{x:-1,y:0},{x:1,y:0},{x:0,y:-1},{x:-2,y:0},{x:2,y:0}];for(const s of i){const r=this.active.x+s.x,n=this.active.y+s.y;if(this._canPlace(this.active.type,r,n,e))return this.active.x=r,this.active.y=n,this.active.rot=e,!0}return!1}hardDrop(){if(!this.active)return{locked:!1,linesCleared:0};for(;this._canPlace(this.active.type,this.active.x,this.active.y+1,this.active.rot);)this.active.y++;return this.lockActive()}holdPiece(){if(!this.active||this.holdUsed)return!1;const t=this.active.type;if(!this.hold)this.hold=t,this.spawnPiece();else{const e=this.hold;this.hold=t,this._spawnSpecific(e)}return this.holdUsed=!0,!0}lockActive(){if(!this.active)return{locked:!1,linesCleared:0};const t=this._getBlocks(this.active.type,this.active.rot);for(const i of t){const s=this.active.x+i.x,r=this.active.y+i.y;if(r<0)return this.gameOver=!0,{locked:!1,linesCleared:0};this.grid[r][s]={type:this.active.type}}const e=this._clearLines();return this.spawnPiece(),{locked:!0,linesCleared:e}}isNearOverflow(){for(let t=0;t<2;t++)for(let e=0;e<this.width;e++)if(this.grid[t][e])return!0;return!1}findCriticalZones(){return[]}smoothSurface(){}smoothZone(t){}selectDestructionTargets(t){const e=[];for(let i=this.height-1;i>=0;i--)for(let s=0;s<this.width;s++)if(this.grid[i][s]&&(e.push({x:s,y:i}),e.length>=t))return e;return e}clearCell(t){if(!t)return;const{x:e,y:i}=t;i>=0&&i<this.height&&e>=0&&e<this.width&&(this.grid[i][e]=null)}selectRandomTargets(t){const e=[];for(let s=0;s<this.height;s++)for(let r=0;r<this.width;r++)this.grid[s][r]&&e.push({x:r,y:s});const i=[];for(let s=0;s<t&&e.length>0;s++){const r=Math.floor(this._rng()*e.length);i.push(e.splice(r,1)[0])}return i}selectMassiveDestructionZones(){return[{y0:Math.floor(this.height/2),y1:this.height-1}]}clearZone(t){if(!t)return;const e=Math.max(0,t.y0??0),i=Math.min(this.height-1,t.y1??this.height-1);for(let s=e;s<=i;s++)for(let r=0;r<this.width;r++)this.grid[s][r]=null}completeNearestLine(){for(let t=this.height-1;t>=0;t--){let e=0;for(let i=0;i<this.width;i++)this.grid[t][i]&&e++;if(e>=this.width-1){for(let i=0;i<this.width;i++)this.grid[t][i]={type:"I"};this._clearLines();return}}}clearInstabilityFlags(){}spawnPiece(){this.holdUsed=!1;const t=this._nextFromBag();this._spawnSpecific(t)}_spawnSpecific(t){const e=Math.floor(this.width/2),r={type:t,x:e,y:0,rot:0};if(this._canPlace(t,r.x,r.y,r.rot)||(r.y=-1),!this._canPlace(t,r.x,r.y,r.rot)){this.gameOver=!0,this.active=null;return}this.active=r}_stepDown(){return this.active?this._canPlace(this.active.type,this.active.x,this.active.y+1,this.active.rot)?(this.active.y+=1,{moved:!0,touchedGround:!1}):{moved:!1,touchedGround:!0}:{moved:!1,touchedGround:!1}}_clearLines(){let t=0;for(let e=this.height-1;e>=0;e--){let i=!0;for(let s=0;s<this.width;s++)if(!this.grid[e][s]){i=!1;break}i&&(this.grid.splice(e,1),this.grid.unshift(Array.from({length:this.width},()=>null)),t++,e++)}return t}_getBlocks(t,e){return(y[t]??y.I)[e%4]}_canPlace(t,e,i,s){const r=this._getBlocks(t,s);for(const n of r){const a=e+n.x,h=i+n.y;if(a<0||a>=this.width||h>=this.height||h>=0&&this.grid[h][a])return!1}return!0}_nextFromBag(){if(this._bag.length===0){this._bag=Object.keys(y);for(let t=this._bag.length-1;t>0;t--){const e=Math.floor(this._rng()*(t+1)),i=this._bag[t];this._bag[t]=this._bag[e],this._bag[e]=i}}return this._bag.pop()}}class S{constructor(){this.renderers=new Set,this.isRunning=!1,this.rafId=null,this._boundTick=this._tick.bind(this)}register(t){if(!t||typeof t.render!="function"){console.warn("[CanvasRenderLoop] Invalid renderer registered",t);return}this.renderers.add(t),this._ensureRunning()}unregister(t){t&&(this.renderers.delete(t),this.renderers.size===0&&this._stop())}_ensureRunning(){this.isRunning||(this.isRunning=!0,this.rafId=requestAnimationFrame(this._boundTick))}_stop(){this.isRunning&&(cancelAnimationFrame(this.rafId),this.rafId=null,this.isRunning=!1)}_tick(){if(!this.isRunning)return;let t=!1;for(const e of this.renderers)e.needsRedraw&&(e.render(),t=!0);t?this.rafId=requestAnimationFrame(this._boundTick):(this.isRunning=!1,this.rafId=null)}requestFullRedraw(){for(const t of this.renderers)t.needsRedraw=!0;this._ensureRunning()}destroy(){this._stop(),this.renderers.clear()}}class I{constructor({ctx:t,config:e}){this.ctx=t,this.config=e,this.lastSnapshot=null}updateSnapshot(t){this.lastSnapshot=t}render(){if(!this.lastSnapshot)return;const{width:t,height:e}=this.lastSnapshot,i=this._getCellSize(t,e);this.config.grid.showGrid&&this._drawGrid(t,e,i),this._drawCells(t,e,i)}_drawGrid(t,e,i){const{ctx:s}=this;s.save(),s.strokeStyle=this.config.colors.grid,s.lineWidth=this.config.grid.lineWidth;for(let r=0;r<=e;r++){const n=r*i;s.beginPath(),s.moveTo(0,n),s.lineTo(t*i,n),s.stroke()}for(let r=0;r<=t;r++){const n=r*i;s.beginPath(),s.moveTo(n,0),s.lineTo(n,e*i),s.stroke()}s.restore()}_drawCells(t,e,i){const{ctx:s}=this,r=this.lastSnapshot.cells;for(let n=0;n<e;n++)for(let a=0;a<t;a++){const h=r[n][a];!h||h.isEmpty||this._drawCell(a,n,h,i)}}_drawCell(t,e,i,s){const{ctx:r}=this,n=this.config.cell.cornerRadius;r.save(),r.fillStyle=this.config.colors.blocks[i.type]||this.config.colors.blocks.default;const a=t*s,h=e*s;this._drawRoundedRect(a,h,s,s,n),r.restore()}_getCellSize(t,e){const i=this.ctx.canvas.width,s=this.ctx.canvas.height,r=i/t,n=s/e;return Math.min(r,n)*this.config.cell.scale}_drawRoundedRect(t,e,i,s,r){const{ctx:n}=this;n.beginPath(),n.moveTo(t+r,e),n.lineTo(t+i-r,e),n.quadraticCurveTo(t+i,e,t+i,e+r),n.lineTo(t+i,e+s-r),n.quadraticCurveTo(t+i,e+s,t+i-r,e+s),n.lineTo(t+r,e+s),n.quadraticCurveTo(t,e+s,t,e+s-r),n.lineTo(t,e+r),n.quadraticCurveTo(t,e,t+r,e),n.closePath(),n.fill()}}class P{constructor(){this.current=null,this.target=null,this.animationTime=0,this.duration=120}setTarget(t){if(!this.current){this.current=this._clone(t),this.target=this._clone(t),this.animationTime=0;return}this.current=this.getInterpolated(),this.target=this._clone(t),this.animationTime=0}update(t){this.target&&(this.animationTime+=t,this.animationTime>this.duration&&(this.animationTime=this.duration))}getInterpolated(){if(!this.current||!this.target)return null;const t=Math.min(this.animationTime/this.duration,1);return{type:this.target.type,blocks:this.target.blocks,rotation:this._lerpAngle(this.current.rotation,this.target.rotation,t),position:{x:this._lerp(this.current.position.x,this.target.position.x,t),y:this._lerp(this.current.position.y,this.target.position.y,t)}}}_lerp(t,e,i){return t+(e-t)*i}_lerpAngle(t,e,i){let s=e-t;return s>Math.PI&&(s-=Math.PI*2),s<-Math.PI&&(s+=Math.PI*2),t+s*i}_clone(t){return JSON.parse(JSON.stringify(t))}reset(){this.current=null,this.target=null,this.animationTime=0}}class E{constructor(){this.softDropMultiplier=1,this.hardDropImpulse=0,this.hardDropDuration=80,this.hardDropTime=0}onSoftDropStart(){this.softDropMultiplier=2.5}onSoftDropEnd(){this.softDropMultiplier=1}onHardDrop(){this.hardDropImpulse=1,this.hardDropTime=0}update(t){if(this.hardDropImpulse>0){this.hardDropTime+=t;const e=Math.min(this.hardDropTime/this.hardDropDuration,1);this.hardDropImpulse=1-e,e>=1&&(this.hardDropImpulse=0,this.hardDropTime=0)}}apply(t,e){let i=t;return this.softDropMultiplier>1&&(i+=e/16*(this.softDropMultiplier-1)),this.hardDropImpulse>0&&(i+=this.hardDropImpulse*.6),i}reset(){this.softDropMultiplier=1,this.hardDropImpulse=0,this.hardDropTime=0}}class F{constructor({ctx:t,config:e}){this.ctx=t,this.config=e,this.animator=new P,this.dropAnimator=new E,this.activePiece=null,this.ghostPiece=null,this._deltaMs=0}updateActivePiece(t){this.activePiece=t,t?this.animator.setTarget(t):this.animator.reset()}updateGhostPiece(t){this.ghostPiece=t}render(t,e=16){if(!t)return;this._deltaMs=e,this.animator.update(e),this.dropAnimator.update(e),this.ghostPiece&&this._drawPiece(this.ghostPiece,t,!0);const i=this.animator.getInterpolated();i&&(i.position.y=this.dropAnimator.apply(i.position.y,e),this._drawPiece(i,t,!1))}_drawPiece(t,e,i){const{ctx:s}=this,{blocks:r,type:n,position:a}=t;s.save();const h=this.config.colors.blocks[n]||this.config.colors.blocks.default;s.fillStyle=i?this._applyGhostStyle(h):h;for(const _ of r){const b=(a.x+_.x)*e,D=(a.y+_.y)*e;this._drawBlock(b,D,e)}s.restore()}_drawBlock(t,e,i){const s=this.config.cell.cornerRadius,r=this.ctx;r.beginPath(),r.moveTo(t+s,e),r.lineTo(t+i-s,e),r.quadraticCurveTo(t+i,e,t+i,e+s),r.lineTo(t+i,e+i-s),r.quadraticCurveTo(t+i,e+i,t+i-s,e+i),r.lineTo(t+s,e+i),r.quadraticCurveTo(t,e+i,t,e+i-s),r.lineTo(t,e+s),r.quadraticCurveTo(t,e,t+s,e),r.closePath(),r.fill()}_applyGhostStyle(t){if(!t.startsWith("#"))return t;const e=parseInt(t.slice(1,3),16),i=parseInt(t.slice(3,5),16),s=parseInt(t.slice(5,7),16);return`rgba(${e}, ${i}, ${s}, 0.25)`}clear(){this.activePiece=null,this.ghostPiece=null,this.animator.reset(),this.dropAnimator.reset()}}const c=class c{static clamp(t){return t<c.BACKGROUND?c.BACKGROUND:t>c.CRITICAL?c.CRITICAL:t}};d(c,"CRITICAL",1e3),d(c,"HIGH",750),d(c,"MEDIUM",500),d(c,"LOW",250),d(c,"BACKGROUND",100);let f=c;class v{constructor({maxActiveFX:t=12,softLimit:e=8}={}){this.maxActiveFX=t,this.softLimit=e,this.activeFX=[]}tryRegister(t){if(!t||typeof t.priority!="number")return!1;if(t.priority=f.clamp(t.priority),this.activeFX.length<this.softLimit)return this.activeFX.push(t),!0;if(this.activeFX.length>=this.maxActiveFX){const e=this._findLowestPriority();if(!e||e.priority>=t.priority)return!1;this._remove(e)}return this.activeFX.push(t),!0}unregister(t){this._remove(t)}clear(){this.activeFX.length=0}_findLowestPriority(){let t=null;for(const e of this.activeFX)(!t||e.priority<t.priority)&&(t=e);return t}_remove(t){const e=this.activeFX.indexOf(t);e!==-1&&this.activeFX.splice(e,1)}}class M{constructor({rootElement:t,boardSystem:e,eventBus:i,config:s,renderLoop:r,vfxIntensity:n="MED"}){if(this.rootElement=t||document.getElementById("gameRoot")||document.body,this.boardSystem=e,this.eventBus=i,this.config=s,this.renderLoop=r||this._createFallbackRenderLoop(),this.canvas=null,this.ctx=null,this.boardLayer=null,this.pieceLayer=null,this.fxLayers=[],this.vfxIntensity=n,this.fxBudget=this._createFXBudgetController(n),this.needsRedraw=!0,!this.rootElement)throw new Error("CanvasBoardRenderer: rootElement is required (provide #gameRoot or document.body).");this._initCanvas(),this._initLayers(),this._bindEvents(),this._resize(),this.renderLoop.register(this),this._requestRedraw()}_initCanvas(){this.canvas=document.createElement("canvas"),this.canvas.classList.add("gameplay-canvas"),this.ctx=this.canvas.getContext("2d",{alpha:!1,desynchronized:!0}),(this.rootElement&&this.rootElement.appendChild?this.rootElement:document.body).appendChild(this.canvas)}_initLayers(){this.boardLayer=new I({ctx:this.ctx,config:this.config}),this.pieceLayer=new F({ctx:this.ctx,config:this.config})}registerFXLayer(t,e){const i=typeof e=="number"?e:f&&f.MEDIUM?f.MEDIUM:500;this.fxLayers.push({layer:t,priority:i})}_bindEvents(){!this.eventBus||typeof this.eventBus.on!="function"||(this.eventBus.on("BOARD_UPDATED",()=>{this._updateBoardSnapshot(),this._requestRedraw()}),this.eventBus.on("BOARD_RESET",()=>{this._updateBoardSnapshot(),this.pieceLayer.clear(),this._requestRedraw()}),this.eventBus.on("PIECE_UPDATED",t=>{this.pieceLayer.updateActivePiece(t),this._requestRedraw()}),this.eventBus.on("GHOST_PIECE_UPDATED",t=>{this.pieceLayer.updateGhostPiece(t),this._requestRedraw()}),this.eventBus.on("SOFT_DROP_START",()=>{this.pieceLayer.dropAnimator.onSoftDropStart(),this._requestRedraw()}),this.eventBus.on("SOFT_DROP_END",()=>{this.pieceLayer.dropAnimator.onSoftDropEnd(),this._requestRedraw()}),this.eventBus.on("HARD_DROP",()=>{this.pieceLayer.dropAnimator.onHardDrop(),this._requestRedraw()}),window.addEventListener("resize",()=>{this._resize(),this._requestRedraw()}))}_updateBoardSnapshot(){if(!this.boardSystem||typeof this.boardSystem.getBoardSnapshot!="function")return;const t=this.boardSystem.getBoardSnapshot();t&&this.boardLayer.updateSnapshot(t)}render(t=16){if(!this.needsRedraw)return;this.needsRedraw=!1,this._clear(),this.boardLayer.lastSnapshot||this._updateBoardSnapshot(),this.boardLayer.render();const e=this.boardLayer.lastSnapshot;if(e){const s=this._getCellSize(e);this.pieceLayer.render(s,t)}const i=this.fxBudget&&typeof this.fxBudget.filterFX=="function"?this.fxBudget.filterFX(this.fxLayers):this.fxLayers;for(const{layer:s}of i)s&&(typeof s.update=="function"&&s.update(t),this.ctx.save(),this.fxBudget&&typeof this.fxBudget.scaleAlpha=="function"&&(this.ctx.globalAlpha=this.fxBudget.scaleAlpha(this.ctx.globalAlpha||1)),typeof s.render=="function"&&s.render(this.ctx),this.ctx.restore())}_requestRedraw(){this.needsRedraw||(this.needsRedraw=!0,this.renderLoop&&typeof this.renderLoop.requestFullRedraw=="function"&&this.renderLoop.requestFullRedraw())}_clear(){!this.ctx||!this.canvas||(this.ctx.fillStyle=this.config?.colors?.background||"#0b0f14",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height))}_getCellSize(t){const e=this.canvas.width/t.width,i=this.canvas.height/t.height;return Math.min(e,i)}_resize(){if(!this.canvas||!this.ctx)return;const t=this.rootElement&&typeof this.rootElement.getBoundingClientRect=="function"?this.rootElement.getBoundingClientRect():{width:window.innerWidth,height:window.innerHeight},e=window.devicePixelRatio||1;this.canvas.width=t.width*e,this.canvas.height=t.height*e,this.canvas.style.width=`${t.width}px`,this.canvas.style.height=`${t.height}px`,this.ctx.setTransform(e,0,0,e,0,0)}destroy(){this.renderLoop&&typeof this.renderLoop.unregister=="function"&&this.renderLoop.unregister(this),this.canvas&&this.canvas.parentNode&&this.canvas.parentNode.removeChild(this.canvas)}_createFXBudgetController(t){const e=typeof t=="string"?t.toUpperCase():"MED",i={LOW:{maxActiveFX:6,softLimit:4},MED:{maxActiveFX:10,softLimit:7},HIGH:{maxActiveFX:14,softLimit:10}},s=i[e]||i.MED;try{return new v(s)}catch{return new v(t)}}_createFallbackRenderLoop(){let t=null,e=null;const i=s=>{t&&typeof t.render=="function"&&t.render(16),e=window.requestAnimationFrame(i)};return{register(s){t=s,e||(e=window.requestAnimationFrame(i))},unregister(s){t===s&&(t=null),e&&(window.cancelAnimationFrame(e),e=null)},requestFullRedraw(){t&&(t.needsRedraw=!0)}}}}const g={board:{defaultWidth:10,defaultHeight:20,padding:{top:8,right:8,bottom:8,left:8}},cell:{scale:1,gap:1,cornerRadius:2},colors:{background:"#0b0e13",grid:"#1c2330",emptyCell:"#0b0e13",blocks:{I:"#5fd3ff",O:"#ffd966",T:"#b98cff",S:"#7dff8b",Z:"#ff6b6b",J:"#6b8cff",L:"#ff9f43",default:"#aaaaaa"},criticalOverlay:"rgba(255, 80, 80, 0.15)"},grid:{lineWidth:1,showGrid:!0},performance:{lowQualityMode:!1},accessibility:{globalScale:1,highContrast:!1}};console.log("[BOOT] World of Tetris â€” Live Board Bootstrap");console.log("MAIN_JS_VERSION = 2026-01-10-LIVE-BOARD-A6");const O=document.getElementById("gameRoot")||document.body;k?.();const p=new A,l=new C({width:10,height:20}),q={getBoardSnapshot:()=>l.getBoardSnapshot()},G=typeof g=="function"?new g:g,x=new S,U=new M({rootElement:O,eventBus:p,boardSystem:q,canvasConfig:G,renderLoop:x});x.register(U);function u(){p.emit("BOARD_UPDATED",l.getBoardSnapshot()),p.emit("PIECE_UPDATED",l.getActivePieceSnapshot()),p.emit("GHOST_UPDATED",l.getGhostPieceSnapshot())}u();const m={softDrop:!1};function X(o){switch(["ArrowLeft","ArrowRight","ArrowDown","ArrowUp"," "].includes(o.key)&&o.preventDefault(),o.code){case"ArrowLeft":l.moveLeft(),u();break;case"ArrowRight":l.moveRight(),u();break;case"ArrowUp":case"KeyX":l.rotateCW(),u();break;case"KeyZ":l.rotateCCW(),u();break;case"ArrowDown":m.softDrop=!0;break;case"Space":l.hardDrop(),u();break;case"KeyR":l.reset(),u();break}}function W(o){o.code==="ArrowDown"&&(m.softDrop=!1)}window.addEventListener("keydown",X,{passive:!1});window.addEventListener("keyup",W,{passive:!0});const w=new L({tickRate:60});w.onTick=o=>{l.update(o,{softDrop:m.softDrop}),u(),x.tick(o)};w.start();console.log("[BOOT] Live Board started successfully");
//# sourceMappingURL=app.js.map
